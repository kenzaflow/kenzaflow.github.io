import{r as a,j as n,B as h,v as Z,P as J,T as K,af as Q}from"./index-iJOU9LjR.js";import{u as Y,a as tt,A as et,m as ot}from"./use-colors-BxM1ci3V.js";import{u as V,B as it}from"./noise-BnVVm7Zg.js";const nt={x:0,y:0,width:0,height:0,top:0,left:0,bottom:0,right:0};function st(u){const l=a.useRef(0),o=a.useRef(null),[p,m]=a.useState(nt),c=a.useMemo(()=>typeof window<"u"?new ResizeObserver(j=>{const P=j[0];P&&(cancelAnimationFrame(l.current),l.current=requestAnimationFrame(()=>{o.current&&m(P.contentRect)}))}):null,[]);return a.useEffect(()=>(o.current&&(c==null||c.observe(o.current,u)),()=>{c==null||c.disconnect(),l.current&&cancelAnimationFrame(l.current)}),[o.current]),[o,p]}function rt(u){const[l,{width:o,height:p}]=st(u);return{ref:l,width:o,height:p}}function at({children:u,manifest:l}){const{taskGetZIndex:o}=V(),p=Y(),m=p?0:8,c=p?74:86;return n.jsx(n.Fragment,{children:n.jsx(h,{style:{zIndex:3+o(l.appId),pointerEvents:"none",userSelect:"none",willChange:"auto"},pos:"absolute",top:m,bottom:c,left:m,right:m,children:u})})}const lt="_resbar_18vfs_1",ht="_forcegrabbing_18vfs_10",z={resbar:lt,forcegrabbing:ht},pt=320,ut=320;function dt({children:u,manageButtonsElement:l,manifest:o}){var O,_,H,X;const p=Y(),{taskIsMaximized:m,toggleAppMaximized:c,taskIsFocused:j,toggleAppIsVisible:P,taskIsOpen:S,taskIsMinimized:T}=V(),I=a.useMemo(()=>{var t;return((t=o.minSize)==null?void 0:t.width)||pt},[(O=o.minSize)==null?void 0:O.width]),E=a.useMemo(()=>{var t;return((t=o.minSize)==null?void 0:t.height)||ut},[(_=o.minSize)==null?void 0:_.height]),D=a.useMemo(()=>{var t;return((t=o.defaultSize)==null?void 0:t.width)||I},[(H=o.defaultSize)==null?void 0:H.width,I]),C=a.useMemo(()=>{var t;return((t=o.defaultSize)==null?void 0:t.height)||E},[(X=o.defaultSize)==null?void 0:X.height,E]),{ref:$,width:M,height:R}=rt(),[i,W]=a.useState(null);a.useEffect(()=>{M&&R&&!i&&W({left:M/2-D/2,top:R/2-C/2,width:D,height:C})},[C,D,R,i,M]);const[B,U]=a.useState({x:0,y:0}),[s,N]=a.useState({topbar:!1,left:!1,leftTop:!1,top:!1,topRight:!1,right:!1,rightBottom:!1,bottom:!1,bottomLeft:!1}),F=(t,r)=>({...t==="topbar"&&{topbar:r==="down"},...t==="left"&&{left:r==="down"},...t==="top"&&{top:r==="down"},...t==="right"&&{right:r==="down"},...t==="bottom"&&{bottom:r==="down"},...t==="leftTop"&&{leftTop:r==="down"},...t==="topRight"&&{topRight:r==="down"},...t==="rightBottom"&&{rightBottom:r==="down"},...t==="bottomLeft"&&{bottomLeft:r==="down"}}),g=(t,r)=>{r.target.setPointerCapture(r.pointerId),U({x:r.clientX,y:r.clientY}),N({...s,...F(t,"down")})},q=t=>{U({x:t.clientX,y:t.clientY})},A=a.useMemo(()=>p||m(o.appId),[p,o.appId,m]),w=t=>{if(t.target.setPointerCapture(t.pointerId),Object.values(s).every(f=>f===!1))return;const y=t.clientX-B.x,v=t.clientY-B.y;let e={};if(i&&(s.topbar&&(e={...e,left:i.left+y,top:i.top+v}),(s.left||s.leftTop||s.bottomLeft)&&(e={...e,left:i.left+y,width:i.width-y}),(s.top||s.leftTop||s.topRight)&&(e={...e,top:i.top+v,height:i.height-v}),(s.right||s.topRight||s.rightBottom)&&(e={...e,width:i.width+y}),(s.bottom||s.rightBottom||s.bottomLeft)&&(e={...e,height:i.height+v})),Object.keys(e).length>0){const f={width:M,height:R};if(A)return;i&&(s.topbar?("left"in e&&(e.left<0&&(e.left=0),e.left+i.width>0+f.width&&(e.left=f.width-i.width)),"top"in e&&(e.top<0&&(e.top=0),e.top+i.height>0+f.height&&(e.top=f.height-i.height))):("left"in e&&(e.left<0&&(e.left=0,"width"in e&&delete e.width),e.left+i.width>0+f.width&&(e.left=f.width-i.width)),"top"in e&&(e.top<0&&(e.top=0,"height"in e&&delete e.height),e.top+i.height>0+f.height&&(e.top=f.height-i.height)),"width"in e&&(e.width+i.left>f.width&&delete e.width,e.width<I&&(delete e.width,"left"in e&&delete e.left)),"height"in e&&(e.height+i.top>f.height&&delete e.height,e.height<E&&(delete e.height,"top"in e&&delete e.top))),W({...i,...e})),q(t)}},b=(t,r)=>{r.target.releasePointerCapture(r.pointerId),N({...s,...F(t,"up")})},L=a.useMemo(()=>Object.values(s).some(t=>t===!0),[s]),x=Z(),d=tt(),G=p?0:8,k=a.useMemo(()=>!(S("launcher")&&S(o.appId)||T(o.appId)||p&&!j(o.appId)),[p,o,j,T,S]);return n.jsx(h,{style:{pointerEvents:"none",transition:x.animations&&!L?"all 200ms ease":"none",transform:x.minimizeScale?k?"scale(1)":"scale(0)":void 0,transformOrigin:"bottom",overflow:"clip",overflowClipMargin:"1rem",willChange:"auto",opacity:x.minimizeScale||k?1:0,visibility:k?"visible":"hidden"},pos:"relative",w:"100%",h:"100%",ref:$,children:i?n.jsx(h,{pos:"relative",style:{...A?{left:"0",top:"0",width:"100%",height:"100%"}:{left:i.left,top:i.top,width:i.width,height:i.height},pointerEvents:"none",transition:x.animations&&!L?"all 200ms ease":"none",willChange:"auto"},children:n.jsx(et,{mode:"popLayout",children:S(o.appId)?n.jsxs(J,{component:ot.div,initial:{scale:.5,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.5,opacity:0},onMouseDown:()=>{j(o.appId)||P(o.appId)},pos:"absolute",bg:d==null?void 0:d.bg,radius:G,style:{outlineStyle:"solid",outlineWidth:"1px",outlineColor:d==null?void 0:d.outline,transition:x.animations?"all 200ms ease":"none",backdropFilter:x.transparency&&(d!=null&&d.backdropFilter)?d.backdropFilter:"none",overflow:"hidden",boxShadow:`0px 0px 0px 2px ${d==null?void 0:d.shadow}`,willChange:"auto"},shadow:j(o.appId)?"xl":void 0,h:"100%",w:"100%",display:"grid",left:0,top:0,right:0,bottom:0,children:[n.jsx(K,{mounted:x.transparency,duration:x.animations?void 0:0,children:t=>n.jsx(h,{style:{...t,pointerEvents:"none"},pos:"absolute",left:0,top:0,right:0,bottom:0,children:n.jsx(it,{})})}),n.jsx(h,{pos:"absolute",display:"grid",top:o.canResize?8:0,bottom:o.canResize?8:0,right:o.canResize?8:0,left:o.canResize?8:0,style:{overflow:"hidden",pointerEvents:"auto",gridTemplateRows:"1fr"},onDoubleClick:t=>{t.preventDefault(),!p&&o.canMaximize!==!1&&c(o.appId)},onPointerMove:w,onPointerDown:t=>{g("topbar",t)},onPointerUp:t=>{b("topbar",t)}}),n.jsx(h,{pos:"absolute",display:"grid",top:0,bottom:0,right:0,left:0,style:{overflow:"hidden",gridTemplateRows:"1fr"},children:n.jsx(h,{about:"window-content-parent",style:{overflow:"hidden"},h:"100%",w:"100%",p:0,children:u})}),l,!p&&o.canResize!==!1?n.jsxs(n.Fragment,{children:[n.jsx(h,{onPointerMove:w,onPointerDown:t=>{g("left",t)},onPointerUp:t=>{b("left",t)},style:{pointerEvents:"auto",cursor:"ew-resize"},className:z.resbar,pos:"absolute",left:0,top:0,w:8,bottom:0}),n.jsx(h,{onPointerMove:w,onPointerDown:t=>{g("right",t)},onPointerUp:t=>{b("right",t)},style:{pointerEvents:"auto",cursor:"ew-resize"},className:z.resbar,pos:"absolute",right:0,top:0,w:8,bottom:0}),n.jsx(h,{onPointerMove:w,onPointerDown:t=>{g("top",t)},onPointerUp:t=>{b("top",t)},style:{pointerEvents:"auto",cursor:"ns-resize"},className:z.resbar,pos:"absolute",top:0,left:0,h:8,right:0}),n.jsx(h,{onPointerMove:w,onPointerDown:t=>{g("bottom",t)},onPointerUp:t=>{b("bottom",t)},style:{pointerEvents:"auto",cursor:"ns-resize"},className:z.resbar,pos:"absolute",bottom:0,left:0,h:8,right:0}),n.jsx(h,{onPointerMove:w,onPointerDown:t=>{g("leftTop",t)},onPointerUp:t=>{b("leftTop",t)},style:{pointerEvents:"auto",cursor:"nwse-resize"},className:z.resbar,pos:"absolute",left:0,top:0,w:8,h:8}),n.jsx(h,{onPointerMove:w,onPointerDown:t=>{g("topRight",t)},onPointerUp:t=>{b("topRight",t)},style:{pointerEvents:"auto",cursor:"nesw-resize"},className:z.resbar,pos:"absolute",right:0,top:0,w:8,h:8}),n.jsx(h,{onPointerMove:w,onPointerDown:t=>{g("rightBottom",t)},onPointerUp:t=>{b("rightBottom",t)},style:{pointerEvents:"auto",cursor:"nwse-resize"},className:z.resbar,pos:"absolute",right:0,bottom:0,w:8,h:8}),n.jsx(h,{onPointerMove:w,onPointerDown:t=>{g("bottomLeft",t)},onPointerUp:t=>{b("bottomLeft",t)},style:{pointerEvents:"auto",cursor:"nesw-resize"},className:z.resbar,pos:"absolute",left:0,bottom:0,w:8,h:8})]}):null]},o.appId):null})}):null})}function wt({children:u,manifest:l,manageButtonsElement:o}){return n.jsx(at,{manifest:l,children:n.jsx(dt,{manifest:l,manageButtonsElement:o,children:u})})}function bt(u){const l=a.useContext(Q)??{};if(!l[u])throw new Error(`No manifest found for appId ${u}`);return l[u]}export{wt as W,bt as u};
